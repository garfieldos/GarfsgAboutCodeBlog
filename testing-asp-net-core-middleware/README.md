Code sample for article : http://garfsgaboutcode.com/2018/01/23/testing-asp-net-core-middlewares/
